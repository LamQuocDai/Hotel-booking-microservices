---
alwaysApply: true
---

# ==========================================================

# ğŸ¨ Hotel Booking Microservices System

# ==========================================================

## ğŸ“¦ Tá»•ng quan

Há»‡ thá»‘ng Ä‘áº·t phÃ²ng khÃ¡ch sáº¡n triá»ƒn khai theo mÃ´ hÃ¬nh **Microservices**, gá»“m:

1. **Frontend** (Next.js + TypeScript)
2. **API Gateway** (NestJS)
3. **Account-service** (Java Spring Boot + MySQL)
4. **Booking-service** (.NET 8 + PostgreSQL + Redis)
5. **Payment-service** (Golang + MongoDB)
6. **Consul** (Service discovery)
7. **Prometheus + Grafana** (Monitoring)
8. **Logging stack** (stdout hoáº·c ELK)

Táº¥t cáº£ cÃ¡c service giao tiáº¿p qua **gRPC ná»™i bá»™**, vÃ  chá»‰ **Frontend â†” Gateway** sá»­ dá»¥ng **REST API**.

---

## ğŸ“ Cáº¥u trÃºc thÆ° má»¥c

/hotel-booking/
â”œâ”€â”€ frontend/
â”œâ”€â”€ api-gateway/
â”œâ”€â”€ account-service/
â”œâ”€â”€ booking-service/
â”œâ”€â”€ payment-service/
â”œâ”€â”€ consul/
â”œâ”€â”€ prometheus/
â”œâ”€â”€ grafana/
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md

markdown
Copy code

---

## ğŸ’» Frontend (Next.js + TypeScript)

### Chá»©c nÄƒng

- Giao diá»‡n ngÆ°á»i dÃ¹ng cho khÃ¡ch Ä‘áº·t phÃ²ng, thanh toÃ¡n, vÃ  quáº£n lÃ½ tÃ i khoáº£n.
- Gá»i API thÃ´ng qua `api-gateway` (REST).
- CÃ³ cÃ¡c trang chÃ­nh:
  - `/login`, `/register`
  - `/rooms` (danh sÃ¡ch phÃ²ng)
  - `/room/[id]` (chi tiáº¿t phÃ²ng, Ä‘Ã¡nh giÃ¡, Ä‘áº·t phÃ²ng)
  - `/payment` (thanh toÃ¡n)
  - `/profile` (thÃ´ng tin ngÆ°á»i dÃ¹ng)
- Realtime cáº­p nháº­t tráº¡ng thÃ¡i phÃ²ng báº±ng WebSocket hoáº·c SSE (tá»« Booking-service thÃ´ng qua Gateway).

### CÃ´ng nghá»‡

- Next.js 15 (App Router)
- TypeScript
- Zustand (hoáº·c Redux Toolkit)
- Axios Ä‘á»ƒ gá»i API
- TailwindCSS
- JWT lÆ°u trong cookie (httpOnly)

---

## ğŸŒ API Gateway (NestJS)

### Chá»©c nÄƒng

- Gateway trung gian giá»¯a Frontend vÃ  cÃ¡c service gRPC.
- XÃ¡c thá»±c JWT tá»« Account-service.
- Táº¥t cáº£ request REST tá»« frontend Ä‘Æ°á»£c chuyá»ƒn thÃ nh gRPC call tá»›i backend.
- Ghi log, rate-limit, vÃ  xá»­ lÃ½ lá»—i toÃ n cá»¥c.

### CÃ´ng nghá»‡

- NestJS + TypeScript
- gRPC clients tá»›i Account, Booking, Payment
- JWT middleware xÃ¡c minh public key
- Winston logger
- Dockerfile riÃªng

---

## ğŸ” Account-service (Java Spring Boot + MySQL)

### Vai trÃ²

- Quáº£n lÃ½ ngÆ°á»i dÃ¹ng, vai trÃ², quyá»n háº¡n.
- LÃ  **Identity Provider**, phÃ¡t hÃ nh vÃ  xÃ¡c minh **JWT (RSA)**.

### Báº£ng dá»¯ liá»‡u

- `Account(ID, RoleID, username, email, phone, password, createdAt, deletedAt)`
- `Role(ID, name, createdAt, deletedAt)`
- `Permission(ID, name, permission, createdAt, deletedAt)`
- `RolePermission(ID, RoleID, PermissionID)`

### JWT

- Sá»­ dá»¥ng **RSA key pair**:
  - private key: kÃ½ JWT
  - public key: cho gateway & service khÃ¡c xÃ¡c minh
- Refresh token lÆ°u trong Redis (TTL 7 ngÃ y)

### CÃ´ng nghá»‡

- Spring Boot 3
- Spring Security + JWT
- JPA + Hibernate
- MySQL
- gRPC Server

---

## ğŸ  Booking-service (.NET 8 + PostgreSQL + Redis Lock)

### Vai trÃ²

- Quáº£n lÃ½ phÃ²ng, loáº¡i phÃ²ng, hÃ¬nh áº£nh, Ä‘Ã¡nh giÃ¡, Ä‘á»‹a Ä‘iá»ƒm, vÃ  Ä‘áº·t phÃ²ng.
- Äáº£m báº£o **trÃ¡nh trÃ¹ng Ä‘áº·t phÃ²ng** báº±ng **Redis distributed lock**.

### Báº£ng dá»¯ liá»‡u

- `Room(ID, name, typeRoomID, locationID, createdAt, deletedAt)`
- `TypeRoom(ID, name, pricePerHour, createdAt, deletedAt)`
- `Image(ID, RoomID, url)`
- `Review(ID, roomID, accountID, comment, evaluate, createdAt, updatedAt, deletedAt)`
- `Location(ID, name, address, createdAt, deletedAt)`
- `RoomBooking(ID, roomID, checkinTime, checkoutTime, status[holding, success], createdAt, deletedAt)`

### Redis Lock

- Key: `room:{roomID}:lock`
- TTL: 30 giÃ¢y
- Khi user chá»n phÃ²ng:
  - Náº¿u phÃ²ng chÆ°a bá»‹ khÃ³a â†’ Ä‘áº·t lock â†’ ghi tráº¡ng thÃ¡i "holding"
  - Náº¿u user khÃ´ng thanh toÃ¡n trong 30s â†’ lock tá»± giáº£i phÃ³ng

### CÃ´ng nghá»‡

- ASP.NET Core 8 Web API
- Entity Framework Core + PostgreSQL
- StackExchange.Redis
- gRPC Server + Client
- Serilog cho logging

---

## ğŸ’³ Payment-service (Golang + MongoDB)

### Vai trÃ²

- Quáº£n lÃ½ thanh toÃ¡n, khuyáº¿n mÃ£i, vÃ  giao dá»‹ch.
- Thanh toÃ¡n má»™t pháº§n online.
- Xá»­ lÃ½ rollback náº¿u thanh toÃ¡n tháº¥t báº¡i.
- LiÃªn káº¿t vá»›i Booking-service qua gRPC.

### Collections (MongoDB)

- `Promotion(ID, code, startDate, endDate, discount, createdAt, deletedAt)`
- `Payment(ID, PromotionID, status[paid, yet], total, tax, discount, totalPrice, roomBookingIDs[], createdAt, deletedAt)`
- `Transaction(ID, PaymentID, Method, Status[pending, success, failed], CreatedAt, UpdatedAt)`

### CÃ´ng nghá»‡

- Go 1.22
- Gin framework
- MongoDB driver
- gRPC Server + Client
- Logrus logger

---

## ğŸ§­ Service Discovery (Consul)

- CÃ¡c service Ä‘Äƒng kÃ½ vá»›i Consul khi khá»Ÿi Ä‘á»™ng.
- Gateway truy váº¥n Ä‘á»ƒ biáº¿t Ä‘á»‹a chá»‰ runtime.
- Cáº¥u hÃ¬nh file `consul/config.hcl`.
- Port máº·c Ä‘á»‹nh: `8500`.

---

## ğŸ“Š Monitoring

- **Prometheus** thu metrics tá»« táº¥t cáº£ service (`/metrics` endpoint).
- **Grafana** hiá»ƒn thá»‹ dashboard.
- Má»—i service export basic metrics (CPU, request count, latency).

---

## ğŸ§¾ Logging

- Booking: Serilog (JSON stdout)
- Payment: Logrus
- Account: SLF4J
- Gateway: Winston
- Docker thu log stdout Ä‘á»ƒ gá»­i vá» ELK (tÃ¹y chá»n).

---

## ğŸ³ Docker & Deployment

### Dockerfile

Má»—i service cÃ³ Dockerfile riÃªng:

- Base image phÃ¹ há»£p vá»›i ngÃ´n ngá»¯.
- Copy source code.
- Build vÃ  expose port.
- CMD cháº¡y á»©ng dá»¥ng.

### docker-compose.yml (á»Ÿ root)

Chá»©a:

- frontend
- api-gateway
- account-service
- booking-service
- payment-service
- consul
- redis
- mongodb
- postgres
- mysql
- prometheus
- grafana

Táº¥t cáº£ cÃ¹ng network `hotel_net`.

---

## âš™ï¸ Quy táº¯c chung

- Dá»¯ liá»‡u thá»i gian dÃ¹ng **UTC**.
- API response format:
  ```json
  { "data": ..., "message": "string", "statusCode": 200 }
  Giao tiáº¿p giá»¯a cÃ¡c service ná»™i bá»™: gRPC only.
  ```

Frontend chá»‰ gá»i api-gateway.

JWT xÃ¡c minh á»Ÿ gateway trÆ°á»›c khi chuyá»ƒn tiáº¿p request.

TÃªn biáº¿n vÃ  field theo camelCase.

Code pháº£i tuÃ¢n thá»§ Clean Architecture + SOLID.

ğŸ“˜ Ghi chÃº

Má»—i DB sá»­ dá»¥ng Docker volume Ä‘á»ƒ lÆ°u dá»¯ liá»‡u.

CÃ³ thá»ƒ má»Ÿ rá»™ng báº±ng Kafka náº¿u cáº§n event-driven.

Khi triá»ƒn khai production, thay docker-compose báº±ng Kubernetes Helm chart.